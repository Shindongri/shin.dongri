---
title: 「리팩터링 2판」 을 읽으며 ②
date: "2020-06-05T00:00:00.001Z"
---

언제 리팩터링을 해야하는지

<!-- more -->

<a style="display: flex; justify-content: center; padding: 0 10%" href="http://www.yes24.com/Product/Goods/89649360" rel="noopener noreferer">
    <img src="https://image.yes24.com/goods/89649360/800x0" style="width: 100%; height: 100%;" />
</a>

---

## 언제 리팩터링해야 할까?
<br />

#### - 준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기

리팩터링하기 가장 좋은 시점은 **코드베이스에 기능을 새로 추가하기 직전**이다. 
이 시점에 현재 코드를 살펴보면서, 구조를 살짝 바꾸면 다른 작업을 하기가 훨씬 쉬워질 만한 부분을 찾는다.

가령 내 요구사항을 거의 만족하지만 리터럴 값 몇 개가 방해되는 함수가 있을 수 있다.
함수를 복제해서 해당 값만 수정해도 되지만, 그러면 중복 코드가 생긴다.

이럴 때는 **함수 매개변수화하기**를 적용한다. 그러고 나면 그 함수에 필요한 매개변수를 지정해서 호출하기만 하면 된다.

버그를 잡을 때도 마찬가지이다. 오류를 일으키는 코드가 세 곳에 복제되어 퍼져 있다면, 우선 한 곳으로 합치는 편이 작업하기에 훨씬 편하다.

이처럼 **준비를 위한 리팩터링(Preparatory Refactoring)** 으로 상황을 개선해놓으면 버그가 수정된 상태가 오래 지속될 가능성을 높이는 동시에,
같은 곳에서 다른 버그가 발생할 가능성을 줄일 수도 있다.


#### - 이해를 위한 리팩터링: 코드를 이해하기 쉽게 만들기

코드를 수정하려면 먼저 그 코드가 하는 일을 파악해야 한다. 그 코드를 작성한 사람은 자신일 수도 있고 다른 사람일 수도 있다. 

리팩터링하면 머리로 이해한 것을 코드에 옮겨 담을 수 있다. 그런 다음 수정한 코드를 테스트해보면 내 생각이 맞았는지 확인 할 수 있다.
내가 이해한 것을 코드에 반영해두면 더 오래 보존할 수 있을 뿐만 아니라 동료도 알 수 있다.

이렇게 하면 나중은 물론 지금 당장 효과를 볼 때도 많다. 바로 자잘한 세부 코드에 **이해를 위한 리팩터링(Comprehension Refactoring)** 을 말한다.

어떤 역할을 하는지 이해된 변수는 적절한 이름으로 바꿔주고, 긴 함수를 잘게 나누기도 한다. 그러면 코드가 깔끔하게 정리되어 전에는 보이지 않던 설계가 눈에 들어오기 시작한다.

랄프 존슨(Ralph Johnson)은 이런 초기 단계의 리팩터링을 

> 밖을 잘 내다보기 위한 창문 닦기

에 비유한다.

코드를 분석할 때 리팩토링을 해보면, 그렇지 않았더라면 도달하지 못했을 더 깊은 수준까지 이해하게 된다.

#### - 쓰레기 줍기 리팩터링

코드를 파악하던 중에 일을 비효율적으로 처리하는 모습을 발견할 때가 있다. 
로직이 쓸데없이 복잡하거나, 매개변수화한 함수 하나면 될 일을 거의 똑같은 함수 여러 개로 작성해놨을 수 있다. 

**이때 약간 절충을 해야 한다.** 

원래 하려던 작업과 관련 없는 일에 너무 많은 시간을 빼앗기긴 싫을 것이다. 그렇다고 쓰레기가 나뒹굴게 방치해서 나중에 일을 방해하도록 내버려두는 것도 좋지 않다.

나라면 간단히 수정할 수 있는 것은 즉시 고치고, 시간이 좀 걸리는 일은 짧은 메모만 남긴 다음, 하던 일을 끝내고 나서 처리한다.

이것이 이해를 위한 리팩터링의 변형인 **쓰레기 줍기 리팩터링(Litter-Pickup Refactoring)** 이다.

#### - 계획된 리팩터링과 수시로 하는 리팩터링

앞서 본 준비를 위한 리팩터링, 이해를 위한 리팩터링, 쓰레기 줍기 리팩터링은 모두 기회가 될 때만 진행한다.

나는 개발에 들어가기 전에 리팩터링 일정을 따로 잡아두지 않고, 기능을 추가하거나 버그를 잡는 동안 리팩터링도 함께 한다.

**프로그래밍 과정에 자연스럽게 녹인 것이다.**

기능을 추가할 때든 버그를 잡을 때든, 리팩터링은 눈앞의 문제뿐 아니라 앞으로 할 작업에도 도움을 준다. 간과하기 쉽지만 굉장히 중요한 점이다.

**리팩터링은 프로그래밍과 구분되는 별개의 활동이 아니다.**

> 보기 싫은 코드를 발견하면 리팩터링하자. 그런데 잘 작성된 코드 역시 수많은 리팩터링을 거쳐야 한다.

리팩터링은 과거에 저지른 실수를 바로잡거나 보기 싫은 코드를 정리하는 작업이라고 오해하기 쉽다. 보기 싫은 코드를 보면 리팩터링해야 함은 당연하지만,
잘 작성된 코드 역시 수많은 리팩터링을 거쳐야 한다.

> 무언가 수정하려 할 때는 먼저 수정하기 쉽게 정돈하고 (단, 만만치 않을 수 있다.)
> 그런 다음 쉽게 수정하자
>
> _켄트 벡

그렇다고 계획된 리팩터링이 나쁘다는 말은 아니지만 

**계획된 리팩터링을 하게 되는 일은 최소한 줄여야 한다. 리팩터링 작업 대부분은 드러나지 않게, 기회가 될 때마다 해야 한다.**


#### - 오래 걸리는 리팩터링

리팩터링은 대부분 몇 분 안에 끝난다. 길어야 몇 시간 정도다. 하지만 팀 전체가 달려들어도 몇 주는 걸리는 대규모 리팩터링도 있다.

나는 팀 전체가 리팩터링에 매달리는 데는 회의적이다. **그 보다는 주어진 문제를 몇 주에 걸쳐 조금씩 해결해가는 편이 효과적일 때가 많다.**

누구든지 리팩터링해야할 코드와 관련한 작업을 하게 될 때마다 원하는 방향으로 조금씩 개선하는 식이다.

리팩터링이 코드를 깨트리지 않는다는 장점을 활용하는 것이다. 일부를 변경해도 모든 기능이 항상 올바르게 동작한다.

#### - 코드 리뷰에 리팩터링 활용하기

리팩터링은 다른 이의 코드를 리뷰하는 데도 도움된다. 리팩터링을 활용하기 전에는 코드를 읽고, 그럭저럭 이해한 뒤, 몇 가지 개선 사항을 제시했다. 

지금은 새로운 아이디어가 떠오르면 리팩터링하여 쉽게 구현해넣을 수 있는지부터 살펴본다. 쉽다면 실제로 리팩터링한다. 

이 과정을 몇 번 반복하면 내가 떠올린 아이디어를 실제로 적용했을 때의 모습을 더 명확하게 볼 수 있다.

머리로만 상상하는 게 아니라 눈으로 직접 확인하는 것이다. 그러다 보면 리팩터링해보지 않고는 절대 떠올릴 수 없던 한 차원 높은 아이디어가 떠오르기도 한다.



#### - 관리자에게는 뭐라고 말해야 할까?

"관리자에게 리팩터링에 대해 어떻게 말해야 하나요?"

관리자가 기술에 정통하고 설계 지구력 가설도 잘 이해하고 있다면 리팩터링의 필요성을 쉽게 설득할 수 있다.

이런 관리자는 오히려 정기적인 리팩터링을 권장할 뿐만 아니라 팀이 리팩터링을 충분히 하고 있는지 살펴보기도 한다. 그러면 팀이 수행하는 리팩터링이 과도할 수는 있어도, 부족할 가능성은 거의 없다.

물론 기술을 모르는 상당수의 관리자와 고객은 코드베이스의 건강 상태가 생산성에 미치는 영향을 모른다. 이런 상황에 있는 이들에게는 "리팩터링한다고 말하지 말라"고 조언하겠다.

소프트웨어 개발자는 프로다. 프로 개발자의 역할은 효과적인 소프트웨어를 최대한 빨리 만드는 것이다. 내 경험상 **리팩터링하면 소프트웨어를 빠르게 만드는 데 아주 효과적이다.**

프로 개발자에게 주어진 임무는 새로운 기능을 빠르게 구현하는 것이고, 가장 빠른 방법은 리팩터링이다. 그래서 리팩터링부터 한다.


#### - 리팩터링 하지 말아야 할 때

지저분한 코드를 발견해도 굳이 수정할 필요가 없다면 리팩터링하지 않는다. 

외부 API 다루듯 호출해서 쓰는 코드라면 지저분해도 그냥 둔다. 내부 동작을 이해해야 할 시점에 리팩터링해야 효과를 제대로 볼 수 있다.

리팩터링하는 것보다 처음부터 새로 작성하는 게 쉬울 대도 리팩터링하지 않는다.
